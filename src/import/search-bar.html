<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="search-bar">

        <style>
                ul {
                        list-style: none;
                }
        </style>
        <template>

                <iron-ajax
                        auto
                        url="http://xedule.novaember.com/organisations.json"
                        handle-as="json"
                        last-response="{{organisations}}">
                </iron-ajax>

                <ul>
                        <template is="dom-repeat" items="{{organisations}}" sort="_sort">
                                <li><paper-item><a href="#" data-org$="{{item.id}}" on-click="goto">{{item.name}}</a></paper-item></li>
                        </template>
                </ul>

        </template>
        <script>
                Polymer({
                        is: "search-bar",
                        goto: function(e) {
                                console.log(e.target.getAttribute('data-org'));
                        },
                        _sort: function(a, b) {
                                var regex = /@(.*)/;
                                var a_name = a.name.match(regex)[1];
                                var b_name = b.name.match(regex)[1];
                                
                                if (a_name == b_name) {
                                        if (a.name === b.name)
                                                return 0;

                                        return a.name < b.name ? -1 : 1;
                                }

                                return a_name < b_name ? -1 : 1;
                        }
                });
        </script>
</dom-module>
